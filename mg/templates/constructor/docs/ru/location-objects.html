<!-- doc.title Объекты на локациях -->
<!-- doc.parent locations -->
<!-- doc.keywords локации, объекты, онлайн-игры -->
<!-- doc.description Описание подсистемы объектов на локациях в конструкторе онлайн-игр -->

<h1>Объекты на локациях</h1>

<p>Зачастую для отображения локации одной статической картинки недостаточно. Администратору может понадобиться показывать поверх локации какие-либо дополнительные картинки-объекты. Объекты должны быть кликабельными, они должны иметь возможность показываться или не показываться. Может потребоваться изменять их местоположение на экране.</p>

<p>Для реализации этих возможностей предназначен <a href="/doc/modules">системный модуль</a> "Статические объекты на локациях". После его включения в настройках локаций появится дополнительный способ визуализации: "HTML5 Canvas": <img class="doc-screenshot" src="/st/tutorial/location-objects-1.png" alt="" /></p>

<h1>Настройка статических объектов</h1>

<p>При выборе для локации типа визуализации "Статические объекты на локациях" в настройках локации появится новая вкладка &mdash; Объекты: <img class="doc-screenshot" src="/st/tutorial/location-objects-2.png" alt="" /></p>

<p>При помощи кнопок "Загрузить изображение" и "Добавить изображение из хранилища" можно создавать новые объекты и помещать их на локацию. Объекты можно перетаскивать при помощи мыши. При двойном щелчке на объекте он отправляется на задний план. У выделенного объекта можно при помощи мыши перетаскивать вершины активной зоны (на которой будут восприниматься нажатия мыши и при наведении на которую будут показываться всплывающие подсказки). Чтобы добавить новую вершину, необходимо щёлкнуть на ребре многоугольника. Чтобы удалить вершину, необходимо выделить её мышью, а затем нажать кнопку Delete. Объекты также удаляются при помощи кнопки Delete.</p>

<p>При выборе объекта внизу раскрывается панель с его настройками: <img class="doc-screenshot" src="/st/tutorial/location-objects-3.png" alt="" /></p>

<ul>
    <li>Идентификатор объекта &mdash; строка, начинающаяся с "u_". Если объекту назначить идентификатор, то в дальнейшем можно изменять его видимости и положение динамически при помощи JavaScript API;</li>
    <li>центр X и центр Y &mdash; координаты центра изображения. Чтобы изменить эти параметры, необходимо подвинуть объект при помощи мыши;</li>
    <li>скриптовое положение объекта &mdash; возможность вычислять положение объекта при помощи скриптового выражения (см. следующий раздел);</li>
    <li>вершины активной зоны &mdash; координаты многоугольника, определяющего активную зону объекта. Координаты заданы относительно центра объекта;</li>
    <li>условие видимости &mdash; <a href="/doc/script">скриптовое выражение</a>, определяющее видимость объекта. 0 или меньше &mdash; объект невидим (и недоступен для кликов мышью), 1 или больше &mdash; объект полностью видим; если видимость больше 0, но меньше 1, то объект показывается полупрозрачным, причём чем ближе значение к 0, тем он более прозрачный. Выражение может использовать параметр t, и тогда видимость объекта будет меняться с течением времени. Подробности &mdash; в статье "<a href="/doc/dynamic">Параметры, изменяющиеся со временем</a>";</li>
    <li>действие при клике &mdash; настройка поведения игры при клике на активную зону объекта;</li>
    <li>подсказка при наведении мыши &mdash; всплывает при наведении мыши на активную зону.</li>
</ul>

<h1>Скриптовое положение объекта</h1>

<p>Если галочка "скриптовое положение объекта" снята, то объект появится на локации в том месте, в котором он был размещён в редакторе. Если галочку установить, то откроются дополнительные настройки, при помощи которых можно задать <a href="/doc/script">скриптовое выражение</a> для расчёта координат: <img class="doc-screenshot" src="/st/tutorial/location-objects-4.png" alt="" /></p>

<p>Результатом этого выражения должен быть вектор vec3, с тремя координатами: (X, zIndex, Y). Первая и последняя координаты определяют положение объекта на локации, а средняя &mdash; порядок объекта в стопке. Объекты с большим zIndex находятся ближе к наблюдателю.</p> 

<p>Выражение может использовать параметр t, и тогда видимость объекта будет меняться с течением времени. Подробности &mdash; в статье "<a href="/doc/dynamic">Параметры, изменяющиеся со временем</a>".</p>

<h1>Управление объектами через JavaScript</h1>

<p>Администратор игры имеет возможность управлять объектами на локации вручную при помощи JavaScript API. Чтобы получить ссылку на объект по его идентификатору, воспользуйтесь функцией LocObjects.getObject:</p>

<pre class="doc-code-sample">
var obj = LocObjects.getObject('u_test');
</pre>

<p>Каждый объект может иметь параметры, каждый из которых отвечает за какие-то аспекты визуализации или поведения объекта. Сейчас реализованы два параметра:</ul>
<li>1 &mdash; положение объекта (вектор);</li>
<li>2 &mdash; видимость объекта (число от 0 до 1).</li>
</ul></p>

<p>Перед тем, как изменять значение параметра, необходимо получить ссылку на него:</p>
<pre class="doc-code-sample">
var paramPos = obj.getParam(1);
var paramVis = obj.getParam(2);
</pre>

<p>Чтобы установить новое значение, необходимо воспользоваться методом setValue:</p>
<pre class="doc-code-sample">
paramPos.setValue(new Vec3(100, 5, 80));
paramVis.setValue(0.8);
</pre>

<p>Чтобы заставить параметр плавно измениться до желаемого значения, воспользуйтесь методом slideTo:</p>
<pre class="doc-code-sample">
paramVis.slideTo(0, 2);
</pre>
<p>Приведённая выше команда заставит объект плавно за 2 секунды стать невидимым.</p>

<p>Кроме того, администратор имеет возможность задать более сложное выражение для изменения параметра, вручную создав экземпляр <a href="/doc/dynamic#DynamicValue">DynamicValue</a> и передав ему желаемое выражение:</p>
<pre class="doc-code-sample">
paramPos.setValue(new DynamicValue([
    '+',
    new Vec3(100, 0, 0),
    [
        '*',
        [
            'call',
            'sin',
            ['glob', 't']
        ],
        new Vec3(30, 0, 0)
    ]
]));
</pre>

<h1>Дополнительно</h1>

<ul>
    <li><a href="/doc/locations">Система локаций</a></li>
    <li><a href="/doc/script">Скриптовый движок</a></li>
    <li><a href="/doc/dynamic">Параметры, изменяющиеся со временем</a></li>
</ul>
