<!-- doc.title Настройка системы рас и классов в конструкторе онлайн-игр -->
<!-- doc.parent index -->
<!-- doc.keywords раса, класс, профессия, онлайн-игра -->
<!-- doc.description Статья о настройке классов и рас в конструкторе онлайн-игр -->

<p>Расы, классы, професии и прочие аналогичные свойства персонажей являются <a href="/doc/parameters">обычными параметрами</a> с дополнительными возможностями, относящимися к самостоятельному выбору этих параметров игроком. Администратор имеет возможность указать, какие параметры в какой момент запросить у игрока, а также какие варианты из предложенных ему доступны.</p>

<h1>Настройка рас и классов</h1>

<p>Чтобы подключить систему рас и классов к игре, необходимо <a href="/doc/modules">включить модуль</a> "Расы и классы". После этого в меню "Персонажи" у вас появится новый пункт "Расы и классы", а в форме настройки параметров персонажей появится новый пункт "Параметр является классом персонажа".</p>

<p>Чтобы сделать возможность персонажам иметь расу, профессию или иной класс, сначала надо зайти в редактор параметров персонажей (Персонажи / Параметры персонажей), создать новый параметр и назвать его так, как считаете нужным, например "Раса": <img class="doc-screenshot" src="/st/tutorial/charclasses-1.png" alt="" /></p>

<p>Параметр должен обязательно иметь тип "Сохраняется в базе данных". Условие "В каком случае требовать от игрока выбор этого класса" задаёт правило, по которому будет запускаться запрос класса у игрока. Пока игрок не выберет класс для своего персонажа, он не сможет перемещаться по локациям и делать многие другие действия. Примеры условий:</p>
<ul>
	<li>0 &mdash; система никогда не будет запрашивать у игрока выбор класса. Это может быть полезно, если выдача профессии осуществляется не игроком произвольно, а производстся как награда в каком-то квесте. Тогда после успешного прохождения квеста можно будет установить персонажу нужную профессию: <pre class="doc-code-sample">set char.p_race = 1</pre></li>
	<li>1 &mdash; система будет запрашивать выбор класса сразу после создания персонажа (или, если персонаж был зарегистрирован ранее, то сразу после ввода этого правила). Например, если расу персонажа игрок должен выбирать добровольно и сразу после регистрации, то 1 &mdash; это нужный выбор;</li>
	<li>char.p_level &gt;= 4 &mdash; запрашивать выбор класса после 4 уровня;</li>
	<li>char.p_parent_class == 3 &mdash; запрашивать выбор этого класса только у тех персонажей, которые выбрали родительский класс 3. То есть, вы можете создавать иерархию классов, делая выбор дочернего класса доступным только при выборе нужного родительского.</li>
</ul>

<p>Для каждого параметра вы можете задавать различные значения. Например, создав параметр "Раса", вы захотите описать, какие расы есть в вашей игре, и при каких условиях игрок может их выбрать. Это осуществляется через пункт меню "Персонажи / Расы и классы": <img class="doc-screenshot" src="/st/tutorial/charclasses-2.png" alt="" /></p>

<p>В этом списке показываются все параметры, для которых установлен флажок "Параметр является классом персонажа". Зайдя в нужный раздел, вы увидите список доступных вариантов для этого параметра: <img class="doc-screenshot" src="/st/tutorial/charclasses-3.png" alt="" /></p>

<p>У каждого варианта есть свой числовой идентификатор. Именно эти значения будут присваиваться параметру персонажа, когда он будет выбирать расу. И эти же значения необходимо использовать в скриптовом движке, когда вы проверяете или устанавливаете значение расы. Например, чтобы изменить персонажу расу на "Протоссы", необходимо написать:</p>

<pre class="doc-code-sample">
set char.p_race = 3
</pre>

<p>Удалить вариант невозможно, поскольку могут существовать персонажи, у которых выбран этот класс.</p>

<p>При создании или редактировании варианта вам необходимо заполнить форму: <img class="doc-screenshot" src="/st/tutorial/charclasses-4.png" alt="" /></p>

<ul>
	<li>Описание может содержать HTML-теги. В частности, можно вставить изображение персонажа этой расы;</li>
	<li>доступен ли этот вариант класса игроку &mdash; этот параметр позволяет сделать какие-то классы доступными игроку для ручного выбора, а какие-то недоступными. Например, если вы хотите совсем удалить какую-то расу, то вам необходимо прописать в условие доступности "0".</li>
</ul>

<p>Недоступность варианта не означает, что персонажи не могут иметь установленным этот вариант. В частности, если раньше вариант был доступен, и игрок успел его выбрать, то он так и останется. Недоступные варианты также можно без проблем установить персонажу при помощи квестового движка.</p>

<h1>Скриптовая поддержка</h1>

<p>Поскольку расы и классы являются обычными параметрами персонажа, то и получать к ним доступ можно обычным образом через char.p_<strong>код</strong>.</p>

<p>После того, как игрок выбирает класс персонажа через специальный игровой интерфейс, вызывается квестовое событие "charclass-selected", которое можно обработать квестовым движком при помощи инструкции:</p>
<pre class="doc-code-sample">
class selected {
  ...
}
</pre>
<p>В этом обработчике доступны глобальные переменные:</p>
<ul>
	<li>cls &mdash; название выбранного игроком параметра, например, "race";</li>
	<li>oldval &mdash; старое значение параметра (0);</li>
	<li>newval &mdash; новое значение параметра (идентификатор выбранного варианта).</li>
</ul>

<h1>Дополнительно</h1>
<ul>
	<li><a href="/doc/script">Скриптовый движок</a></li>
	<li><a href="/doc/design/character-classes">Оформление селектора классов персонажей</a></li>
	<li><a href="/doc/startloc">Стартовые локации персонажей</a></li>
</ul>
