<!-- doc.title Оформление игрового интерфейса в онлайн-игре -->
<!-- doc.parent index -->
<!-- doc.keywords вёрстка, html, интерфейс, онлайн-игра -->
<!-- doc.description Как правильно оформить страницу интерфейса игры в конструкторе онлайн-игр -->

<h1>Вёрстка игрового интерфейса в конструкторе онлайн-игр</h1>

<p><a href="/doc/design/templates">Общая информация о HTML-шаблонах в конструкторе</a></p>

<p>В отличие от оформления титульных страниц и страниц "социалки", вёрстка собственно игрового интерфейса делается по-другому. В игровом интерфейсе общую структуру страниц задаёт конструктор, руководствуясь вашими настройками из админки. С какой стороны у вас будут какие фреймы, где какие меню и какие на них будут кнопки &mdash; всё задаётся через настройки конструктора. Вам необходимо оформить лишь отдельные блоки (чат, горизонтальная панель кнопок, вертикальная панель кнопок, строка ввода чата и т.д.), а в общую структуру их сошьёт уже движок конструктора.</p>

<p>Чтобы правильно понять логику действия конструктора при вёрстке игрового интерфейса, давайте рассмотрим общую структуру архива с оформлением игры. Для этого выберем любой шаблон из заранее подготовленных, например, "Ржавый металл":</p>
<img class="doc-screenshot" src="/st/tutorial/gameinterface-1.png" alt="" />
<p>Затем скачаем архив с новым сгенерированным оформлением в виде ZIP-архива и распакуем:</p>
<ul>
	<li>blocks.html</li>
	<li>body-bg-1.jpg</li>
	<li>body-bg-2.jpg</li>
	<li>body-bg-3.jpg</li>
	<li>box-bottom.png</li>
	<li>box-left-bottom.png</li>
	<li>box-left.png</li>
	<li>box-left-top.png</li>
	<li>box-right-bottom.png</li>
	<li>box-right.png</li>
	<li>box-right-top.png</li>
	<li>box-top.png</li>
	<li>chat-channel-button-new.png</li>
	<li>chat-channel-button-off.png</li>
	<li>chat-channel-button-on.png</li>
	<li>chat-channel-button.png</li>
	<li>chat-channel-buttons-bottom.gif</li>
	<li>chat-channel-buttons-top.gif</li>
	<li>chat-send.png</li>
	<li>game.css</li>
	<li>horizontal-bg.png</li>
	<li>horizontal-left.png</li>
	<li>horizontal-right.png</li>
	<li>interface.css</li>
	<li>location-down.png</li>
	<li>location-left.png</li>
	<li>location-right.png</li>
	<li>location-up.png</li>
	<li>menu.gif</li>
	<li>menu-item-over.gif</li>
	<li>progress-horizontal-bg.png</li>
	<li>progress-horizontal-left.png</li>
	<li>progress-horizontal-right.png</li>
	<li>progress-vertical-bg.png</li>
	<li>progress-vertical-bottom.png</li>
	<li>progress-vertical-top.png</li>
	<li>roster-buttons-bg.png</li>
	<li>roster-buttons-over.png</li>
	<li>sbox-bottom.png</li>
	<li>sbox-left-bottom.png</li>
	<li>sbox-left.png</li>
	<li>sbox-left-top.png</li>
	<li>sbox-right-bottom.png</li>
	<li>sbox-right.png</li>
	<li>sbox-right-top.png</li>
	<li>sbox-top.png</li>
	<li>tip-anchor-sprite.gif</li>
	<li>tip-sprite.gif</li>
	<li>vertical-bg.png</li>
	<li>vertical-bottom.png</li>
	<li>vertical-top.png</li>
</ul>
<p>Главный файл, описывающий структуру оформления, называется blocks.html. В этом файле перечислены блоки, которые конструктор будет размещать на игровом экране. Порядок блоков значения не имеет. У каждого блока обязательно прописан id="..." и class="x-hidden". Класс x-hidden обозначает, что блок будет скрытым до тех пор, пока конструктор его не возьмёт и явно не поставит на нужное место интерфейса. Атрибут id определяет уникальный идентификатор блока. Для примера рассмотрим блок с оформлением главного игрового фрейма:</p>
<pre class="doc-code-sample">
&lt;div class="x-hidden" id="main"&gt;
        &lt;div class="box-1"&gt;&lt;div class="box-2"&gt;&lt;div class="box-3"&gt;&lt;div class="box-4"&gt;&lt;div class="box-5"&gt;&lt;div class="box-6"&gt;&lt;div class="box-7"&gt;&lt;div class="box-8"&gt;
                &lt;div id="main-content" style="margin: 31px"&gt;&lt;/div&gt;
        &lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
</pre>
<p>Обратите внимание, что внешний div имеет id="main", а самый внутренний &mdash; id="main-content". При размещении этого блока в интерфейсе игры движок конструктора растянет внешний div на ту ширину и высоту, которая необходима, ваша вёрстка растянется вслед за внешним блоком. В том числе, растянется и внутренний блок main-content. И после этого внутрь этого внутреннего блока движок конструктора поместит собственно полезное содержимое. В данном случае это iframe с игровым интерфейсом.</p>

<p>С вёрсткой блоков с шириной и высотой 100% есть нюансы при использовании стилей margin и padding. Разные браузеры отображают такие блоки по-разному. Чтобы сделать интерфейс кроссбраузерным, в движок конструктора заложено множество хаков. В частности, у блока с контентом (id="...-content") стиль margin применяется не к самому этому блоку, а к его содержимому:</p>
<img class="doc-screenshot" src="/st/tutorial/blocks.png" alt="" />
<p>В приведённом выше примере у всех div прописаны "width: 100%" и "height: 100%". Каждый из элементов с class="box-*" определяет фоновую картинку, чтобы оформить границы блока. Чтобы iframe, который будет создан внутри этого блока занял не все 100% ширины и высоты, а отступал от краёв, прописываем style="margin: 31px". Движок конструктора увидит эту запись и применит её к iframe, причём кроссбраузерным образом.</p>

<h2>Возможные блоки и их особенности</h2>

<ul>
	<li>main &mdash; игровой фрейм;</li>
	<li>chat-frame &mdash; фрейм чата (весь вместе с chat-box и chat-input);</li>
	<li>chat-channel-buttons &mdash; панель кнопок переключения каналов чата (если указан класс layout-left, то панель будет расположена вертикально слева от чата. Если не указан, то горизонтально сверху. В первом случае вам понадобится прописать style="width: ...px" у внешнего блока, определяющий ширину панели, а во втором аналогично высоту: style="height: ...px");</li>
	<li>chat-box &mdash; поле для сообщений в чате;</li>
	<li>chat-input &mdash; блок со строкой ввода, кнопкой "отправить" и селектором канала (селектор канала можно убрать, тогда выбор текущего канала будет определяться автоматически или командами чата. У этого блока нет внутреннего chat-input-content. Вместо этого должно быть поле ввода &lt;input id="chat-input-control" /&gt; и кнопка отправки сообщения с действием onclick="Chat.submit()");</li>
	<li>chat-roster &mdash; блок со списком персонажей на канале чата (это весь ростер с заголовком, списком персонажей и с кнопками);</li>
	<li>chat-roster-header &mdash; заголовок ростера (там отображается меню выбора канала ростера. У внешнего блока должен быть задан style="height: ...px", определяющий высоту заголовка);</li>
	<li>chat-roster-characters &mdash; список персонажей на канале;</li>
	<li>panel-roster-buttons &mdash; панель кнопок под ростером (необходимо задать style="height: ...px" у внешнего блока);</li>
	<li>smiles &mdash; всплывающее окно со смайликами;</li>
	<li>payment &mdash; всплывающее окно для формы пополнения счёта;</li>
	<li>margin-left &mdash; левое поле всего игрового интерфейса;</li>
	<li>margin-right &mdash; правое поле всего игрового интерфейса;</li>
	<li>margin-top &mdash; верхнее поле всего игрового интерфейса;</li>
	<li>margin-bottom &mdash; нижнее поле всего игрового интерфейса;</li>
	<li>panel-top &mdash; верхняя панель (необходимо задать style="height: ...px" у внешнего блока);</li>
	<li>panel-main-left &mdash; панель слева от главного фрейма (необходимо задать style="width: ...px" у внешнего блока);</li>
	<li>panel-main-right &mdash; панель справа от главного фрейма (необходимо задать style="width: ...px" у внешнего блока).</li>
</ul>

<h2>CSS-стили игрового интерфейса</h2>

<p>В файле с игровым интерфейсом должны обязательно присутствовать два CSS-файла: game.css и interface.css. Файл game.css &mdash; это общие стили для всех страниц игры. Он будет подключаться не только к игровому интерфейсу, но и к титульной странице и страницам "социалки". В нём имеет смысл описывать стили оформления имён персонажей, цен, валют и т.д. Например, чтобы имя персонажа одинаково отображалось и в игре, и на форуме, и на титульной странице игры, класс .char-name имеет смысл определять именно в этом файле. Файл interface.css подключается только к страницам игрового интерфейса. В нём имеет смысл определять всё остальное &mdash; цвета фона, чата, ссылок, форматы иконок и т.д.</p>

<p>Если вы хотите изменить оформление какого-то элемента игры, прежде всего вам понадобится узнать его id или class. Лучшее средство для этого &mdash; отладчик Firebug для браузера Firefox. Скачать его можно <a href="http://getfirebug.com/downloads">с официальной страницы</a>. Кроме того, прочтите <a href="/doc/design/firebug">нашу краткую инструкцию</a>, как пользоваться Firebug.</p>

<h2>Оформление кнопок</h2>

<p>В игровом интерфейсе вам потребуется отображать различные кнопки, при помощи которых игрок будет переключать режимы игры. Конкретный набор кнопок и их расположение задаются уже средствами самого конструктора, а вам необходимо лишь создать изображения для них.</p>

<p>В типовом интерфейсе, созданном из шаблона, вам понадобится оформить 4 типа кнопок:<ul>
	<li>для горизонтальной панели (horizontal);</li>
	<li>для вертикальной панели (vertical);</li>
	<li>для ростера (roster-buttons);</li>
	<li>для переключателя каналов чата (chat-channel-buttons).</li>
</ul></p>

<p>Чтобы оформить блок кнопок (скажем, horizontal), вам понадобится положить в архив следующие файлы:<ul>
	<li>horizontal-left.png (левая граница блока кнопок);</li>
	<li>horizontal-right.png (правая граница блока кнопок);</li>
	<li>horizontal-bg.png (фон для кнопки);</li>
	<li>horizontal-over.png (полупрозрачная "накладка" для кнопки, опциональна).</li>
</ul></p>

<p>После того, как эти файлы помещены в архив оформления, конструктор сможет правильно отрисовать панель кнопок. Чтобы понять механику конструктора кнопок, посмотрим на рисунок:</p>
<img class="doc-screenshot" src="/st/tutorial/buttons-assembly.png" alt="" />

<p>Изображение каждой кнопки формируется из подложки (*-bg.png), иконки и накладки (*-over.png). Слева и справа от панели расположены картинки *-left.png и *-right.png соответственно. После того, как кнопка сгенерирована, она автоматически сохраняется конструктором в архиве оформления и далее не перегенерируется. Имя, под которым сохраняется картинка, составляется из двух частей &mdash; имени класса панели (horizontal, vertical, и т.д, либо из вашего собственного имени класса, которое вы можете прописать в свойствах панели) и имени файла иконки.</p>

<p>Если вам не понравилось, как выглядит та или иная кнопка, или вы хотите вообще заменить все кнопки на свои собственные, то загрузите архив оформления в виде zip-архива, и вы обнаружите в нём файлы типа horizontal-settings.png, horizontal-auth-logout.png и т.д. Они сгенерировались автоматически. Вы можете их просто перерисовать на свои собственные.</p>

<p>Когда в конструкторе добавляется новая возможность, которая требует своей кнопки, мы предоставляем вместе с этой возможностью и иконку, которая посредством указанного выше механизма автоматически оформится в кнопку, органично вписывающуюся в ваше оформление.</p>

<p>Чтобы конструктор мог правильно рассчитать ширину горизонтального (или высоту вертикального) блока кнопок, ему необходимо знать размеры кнопок и границ блока. Подробнее см. раздел <a href="/doc/design/gameinterface-structure">Структура игрового интерфейса</a>.</p>

<a name="javascript"></a>
<h2>Выполнение произвольного JavaScript</h2>

<p>Администратор игры имеет возможность задать произвольные скрипты, которые будут выполнены в браузере до и после инициализации игрового интерфейса. Эти настройки доступны через меню "Интерфейс игры / Скрипты":</p>

<img class="doc-screenshot" src="/st/tutorial/gameinterface-js.png" alt="" />

<p>Первый скрипт выполняется в момент, когда HTML-документ полностью загружен и подгружены все javascript-модули, используемые игрой. То есть, в этот момент уже можно обращаться к JavaScript API игры. Затем происходит инициализация всех компонентов игрового интерфейса (создание и рендеринг ExtJS-объектов, инициализация параметров персонажа и т.д.) И в последнюю очередь выполняется второй скрипт, где уже полностью доступен весь игровой интерфейс.</p>

<a name="money"></a>
<h2>Отображение в интерфейсе игры денег персонажа</h2>

<p>При каждом изменении денег в кошельке персонажа в клиент приходит соответствующее уведомление. Администратор может настроить игру, чтобы в каком-либо месте игрового интерфейса показывались актуальные значения остатков на счетах.</p>

<p>Первый способ &mdash; это поместить в шаблоны либо в <a href="/doc/design/gameinterface-structure">блок интерфейса</a> специальный тег:</p>
<pre class="doc-code-sample">
&lt;hook:character.money currency="GOLD" /&gt;
</pre>
<p>В атрибуте currency передаётся код валюты. Содержимое этого тега автоматически обновляется при изменении денег в кошельке:</p>
<img class="doc-screenshot" src="/st/tutorial/money-hook.png" alt="" />

<p>Второй способ &mdash; установка ручного JavaScript-обработчика через <a href="#javascript">интерфейс задания произвольного JavaScript</a>:</p>
<pre class="doc-code-sample">
Characters.onMoneyChange = function (info) {
    // info.amount - изменение
    // info.currency - код валюты
    // info.balance - новый баланс
    // info.description - код операции
};
</pre>

<p>Третий способ &mdash; прописать любому HTML-элементу CSS-class "char-money-balance-<strong>КОД</strong>". Содержимое этого тега будет обновляться, когда с сервера приходит информация об изменении денег. Начальное содержимое тега администратор должен задать самостоятельно, поскольку при загрузке интерфейса игры обновление существующих элементов не осуществляется.</p> 

<h2>Дополнительная информация</h2>
<ul>
	<li><a href="/doc/design/internal">Оформление внутренних страниц игрового фрейма</a></li>
	<li><a href="/doc/design/external">Оформление внешних по отношению к окну игры страниц</a></li>
	<li><a href="/doc/design/cabinet">Оформление личного кабинета</a></li>
	<li><a href="/doc/design/info">Оформление информационных сообщений</a></li>
	<li><a href="/doc/design/money">Оформление интерфейса денег персонажа</a></li>
	<li><a href="/doc/design/paid-services">Оформление интерфейса платных услуг</a></li>
        <li><a href="/doc/design/tables">Оформление таблиц произвольного назначения</a></li>
        <li><a href="/doc/design/forms">Оформление форм произвольного назначения</a></li>
        <li><a href="/doc/design/crafting">Оформление интерфейса крафта</a></li>
</ul>
